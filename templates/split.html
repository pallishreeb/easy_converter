<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 flex flex-col min-h-screen">
    <!-- Navbar -->
    <nav class="bg-blue-600 p-4">
        <div class="container mx-auto flex items-center justify-between">
            <a href="{{ url_for('upload_form') }}" class="text-white text-xl font-bold">Easy Converter</a>
            <div class="hidden md:flex space-x-6">
                <a href="{{ url_for('upload_form') }}" class="text-white hover:text-gray-200 font-medium">PDF to
                    Word</a>
                <a href="{{ url_for('resize_image_form') }}" class="text-white hover:text-gray-200 font-medium">Resize
                    Image</a>
                <a href="{{ url_for('split_pdf_form') }}" class="text-white hover:text-gray-200 font-medium">Extract
                    Pages</a>
                <a href="{{ url_for('about') }}" class="text-white hover:text-gray-200 font-medium">About Us</a>
            </div>
            <!-- Mobile menu button -->
            <div class="md:hidden">
                <button id="menu-button" class="text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden mt-2 space-y-2 bg-blue-500 p-4 rounded-lg">
            <a href="{{ url_for('upload_form') }}" class="block text-white hover:text-gray-200">PDF to Word</a>
            <a href="{{ url_for('resize_image_form') }}" class="block text-white hover:text-gray-200">Resize Image</a>
            <a href="{{ url_for('split_pdf_form') }}" class="text-white hover:text-gray-200 font-medium">Extract
                Pages</a>
            <a href="{{ url_for('about') }}" class="block text-white hover:text-gray-200">About Us</a>
        </div>
    </nav>

    <!-- PDF Upload and Preview Section -->
    <main class="flex-grow flex flex-col items-center p-6">
        <h1 class="text-2xl md:text-3xl font-bold text-blue-600 mb-6">Upload and Preview PDF</h1>


        <!-- PDF Upload Form -->
        <form id="pdfUploadForm" action="/upload_pdf" method="post" enctype="multipart/form-data" class="mb-6">
            <input type="file" name="file" id="pdfFileInput" accept="application/pdf" required
                class="border rounded-lg px-4 py-2 mr-2">
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 mt-2">Upload
                PDF</button>
        </form>

        <!-- Extract Pages Form -->
        <form id="extractForm" class="hidden flex flex-col md:flex-row md:items-center gap-4 p-4 "
            action="/extract_pdf_pages" method="POST" enctype="multipart/form-data">
            <input type="file" id="hiddenPdfFileInput" name="file" style="display: none;">

            <div class="flex flex-col md:flex-row md:gap-4 w-full md:w-2/3">
                <div class="flex flex-col w-full md:w-1/2">
                    <label for="startPage" class="mb-1">Start Page:</label>
                    <input type="number" id="startPage" name="start_page" required class="border rounded-md p-2 w-full"
                        placeholder="Enter start page">
                </div>

                <div class="flex flex-col w-full md:w-1/2">
                    <label for="endPage" class="mb-1">End Page:</label>
                    <input type="number" id="endPage" name="end_page" required class="border rounded-md p-2 w-full"
                        placeholder="Enter end page">
                </div>
            </div>

            <button type="submit"
                class="bg-blue-600 text-white px-4 py-2 rounded-md w-full md:w-auto mt-4 md:mt-5">Extract Pages</button>
        </form>



        <!-- PDF Preview Section -->
        <div id="pdfPreview" class="hidden border rounded-lg bg-white p-4 shadow-lg w-full md:w-3/4 lg:w-1/2">
            <canvas id="pdfCanvas" class="w-full border rounded-lg"></canvas>
            <div class="flex justify-between items-center mt-4">
                <button onclick="previousPage()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                    Previous Page
                </button>
                <p class="text-gray-700">
                    Page <span id="page_num">1</span> of <span id="page_count">?</span>
                </p>
                <button onclick="nextPage()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                    Next Page
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-blue-600 text-white p-4 text-center">
        <p>&copy; 2024 Easy Converter. All rights reserved.</p>
    </footer>

    <!-- JavaScript for PDF Viewer and Mobile Menu -->
    <!-- JavaScript for PDF Viewer and Mobile Menu -->
    <script>
        // Mobile menu toggle
        const menuButton = document.getElementById('menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        menuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // PDF.js viewer logic
        let pdfDoc = null,
            pageNum = 1,
            pageRendering = false,
            pageNumPending = null,
            scale = 1.5,
            canvas = document.getElementById('pdfCanvas'),
            ctx = canvas.getContext('2d');

        // Handle form submission to preview the PDF
        document.getElementById('pdfUploadForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(event.target);
            const fileInput = document.getElementById('pdfFileInput');
            const file = fileInput.files[0]; // Get the uploaded file

            try {
                const response = await fetch(event.target.action, {
                    method: 'POST',
                    body: formData
                });
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                pdfjsLib.getDocument(url).promise.then((pdf) => {
                    pdfDoc = pdf;
                    document.getElementById('pdfPreview').classList.remove('hidden');
                    document.getElementById('extractForm').classList.remove('hidden');

                    // Create a new DataTransfer object to hold the file
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);  // 'file' is the variable holding the uploaded PDF file

                    const hiddenInput = document.getElementById('hiddenPdfFileInput');

                    // Check if hiddenInput is not null
                    if (hiddenInput) {
                        // Assign the files from DataTransfer to the hidden input
                        hiddenInput.files = dataTransfer.files;
                        console.log(hiddenInput.files); // Log the entire FileList
                        console.log(hiddenInput.files[0]); // Log the first file to ensure it's accessible
                    } else {
                        console.error("Hidden PDF input not found.");
                    }

                    // Set the number of pages and render the first page
                    if (pdfDoc) {
                        document.getElementById('page_count').textContent = pdfDoc.numPages;
                        renderPage(pageNum);
                    } else {
                        console.error("PDF document is not loaded.");
                    }
                }).catch(error => {
                    console.error("Error loading PDF:", error);
                });



            } catch (error) {
                console.error('Error uploading PDF:', error);
            }
        });

        // Function to render a page
        function renderPage(num) {
            pageRendering = true;
            pdfDoc.getPage(num).then((page) => {
                const viewport = page.getViewport({ scale: scale });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                const renderTask = page.render(renderContext);

                renderTask.promise.then(() => {
                    pageRendering = false;
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });

            document.getElementById('page_num').textContent = num;
        }

        // Handle next/previous buttons
        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        function previousPage() {
            if (pageNum <= 1) {
                return;
            }
            pageNum--;
            queueRenderPage(pageNum);
        }

        function nextPage() {
            if (pageNum >= pdfDoc.numPages) {
                return;
            }
            pageNum++;
            queueRenderPage(pageNum);
        }
    </script>

</body>

</html>