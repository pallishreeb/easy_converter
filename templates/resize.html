<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resize Image</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .loader {
            display: none;
            /* Hide initially */
            margin-left: 8px;
            /* Space between button and loader */
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col">
    <!-- Navbar -->
    <nav class="bg-blue-600 p-4">
        <div class="container mx-auto flex items-center justify-between">
            <a href="{{ url_for('upload_form') }}" class="text-white text-xl font-bold">Easy Converter</a>
            <div class="hidden md:flex space-x-4">
                <a href="{{ url_for('upload_form') }}" class="text-white hover:text-gray-200">PDF to Word</a>
                <a href="{{ url_for('resize_image_form') }}" class="text-white hover:text-gray-200">Resize Image</a>
                <a class="text-white hover:underline" href="{{ url_for('about') }}">About Us</a>
            </div>
            <!-- Mobile menu button -->
            <div class="md:hidden">
                <button id="menu-button" class="text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden mt-2 space-y-2 bg-blue-500 p-4 rounded-lg">
            <a href="{{ url_for('upload_form') }}" class="block text-white">PDF to Word</a>
            <a href="{{ url_for('resize_image_form') }}" class="block text-white">Resize Image</a>
            <a class="text-white hover:underline" href="{{ url_for('about') }}">About Us</a>
        </div>
    </nav>

    <div class="flex flex-col items-center justify-center h-screen">
        <h2 class="text-xl font-bold mb-4">Resize Image</h2>
        <form id="resizeForm" action="{{ url_for('resize_image') }}" method="post" enctype="multipart/form-data"
            class="bg-white p-6 rounded shadow-md">
            <input type="file" name="file" accept="image/*" class="mb-2 w-full border border-gray-300 p-2 rounded"
                required>
            <div class="mb-4">
                <label class="block mb-1 font-bold">Original Size:</label>
                <span id="original-size" class="text-gray-600">Please upload an image to see its size.</span>
            </div>

            <div class="mb-4">
                <label for="width" class="block mb-1 font-bold">Width (px):</label>
                <input type="number" id="width" name="width" placeholder="New Width"
                    class="border border-gray-300 p-2 rounded w-full">
            </div>
            <div class="mb-4">
                <label for="height" class="block mb-1 font-bold">Height (px):</label>
                <input type="number" id="height" name="height" placeholder="New Height"
                    class="border border-gray-300 p-2 rounded w-full">
            </div>

            <div class="mb-4">
                <label for="resolution" class="block mb-1 font-bold">Choose Resolution:</label>
                <select id="resolution" name="resolution" class="border border-gray-300 p-2 rounded w-full">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="background-removal" class="block mb-1 font-bold">Remove Background:</label>
                <input type="checkbox" id="background-removal" name="background_removal">
            </div>

            <div class="mb-4">
                <label for="format" class="block mb-1 font-bold">Convert to:</label>
                <select id="format" name="format" class="border border-gray-300 p-2 rounded w-full">
                    <option value="png">PNG</option>
                    <option value="jpeg">JPEG</option>
                </select>
            </div>

            <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded" id="submitButton">Resize</button>
            <span class="loader" id="loader">Loading...</span>
        </form>
    </div>

    <!-- JavaScript to get original size and handle loading -->
    <script>
        const menuButton = document.getElementById('menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        const fileInput = document.querySelector('input[type="file"]');
        const originalSizeDisplay = document.getElementById('original-size');
        const loader = document.getElementById('loader');
        const submitButton = document.getElementById('submitButton');
        const form = document.getElementById('resizeForm');

        // Display original size
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const img = new Image();
                img.src = URL.createObjectURL(file);
                img.onload = () => {
                    originalSizeDisplay.textContent = `Width: ${img.width}px, Height: ${img.height}px, Size: ${(file.size / 1024).toFixed(2)} KB`;
                };
            } else {
                originalSizeDisplay.textContent = 'Please upload an image to see its size.';
            }
        });

        // Handle form submission
        // Handle form submission
        form.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent default form submission
            loader.style.display = 'inline'; // Show loader
            submitButton.disabled = true; // Disable the button

            // Create FormData object
            const formData = new FormData(form);

            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.blob(); // Assuming you want to download the image
                    const downloadUrl = URL.createObjectURL(result);
                    const formatChoice = formData.get('format'); // Get the selected format
                    const fileExtension = formatChoice === 'jpeg' ? 'jpg' : formatChoice; // Set extension based on format
                    const a = document.createElement('a');
                    a.href = downloadUrl;
                    a.download = `resized_image.${fileExtension}`; // Use the correct file extension
                    document.body.appendChild(a);
                    a.click(); // Programmatically click the link to trigger download
                    a.remove(); // Clean up the link element
                } else {
                    console.error('Error:', response.statusText);
                }
            } catch (error) {
                console.error('Error:', error);
            } finally {
                // Always hide the loader and enable the button after processing
                loader.style.display = 'none'; // Hide loader
                submitButton.disabled = false; // Enable the button
            }
        });


        menuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    </script>
</body>

</html>